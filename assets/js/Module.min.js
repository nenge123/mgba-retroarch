var Module=new class{version=1;__coresname="mgba_config_data";__istouch="ontouchstart"in document;__retroarchcfg="/home/web_user/retroarch/userdata/retroarch.cfg";__FILE__={"un7z.min.js":"assets/js/un7z.min.js","jszip.min.js":"assets/js/jszip.min.js","spark-md5.min.js":"assets/js/spark-md5.min.js","mgba_libretro.js":null,"mgba_libretro.wasm":null};noInitialRun=!0;arguments=["-v","--menu"];preRun=[];postRun=[];print=e=>{};printErr=e=>{this.EVENT.checkLog(e)};canvas=document.querySelector("#canvas");totalDependencies=0;monitorRunDependencies(e){this.totalDependencies=Math.max(this.totalDependencies,e)}async wasmReady(){this.EVENT.onReady()}async StartRetroArch(){if(this.callMain(this.arguments),delete this.callMain,delete this.wasmBinary,this.__FILE__={},(new TextDecoder).decode(FS.readFile("/home/web_user/retroarch/userdata/retroarch.cfg")).split("\n").forEach((e=>{let t=e.split("="),s=t[0].replace(/^\s+?/,"").replace(/\s+?$/,""),r=t[1]&&t[1].replace(/^\s+?"?/,"").replace(/"?\s*?$/,"");this.KeyMap[s]&&r&&(this.KeyMap[s]=r)})),!this.KeyState){this.KeyState={};for(let e in this.KeyMap)this.KeyState[e]=0}FS.syncfs((e=>this.SetConfig({version:this.version}))),this.EVENT.resize()}get BtnMap(){return this.EVENT.BtnMap}async __installwasm(e){let t=this.__coresname.split("_")[0],s=this.REPLACE_MODULE(await(await fetch(`assets/${t}_libretro.js`)).arrayBuffer());if(this.wasmBinary=await this.IDBFS.getContent("coredata",`${t}_libretro.wasm`),!s||!this.wasmBinary)return this.SetConfig({version:null}),this.BtnMap.reload();this.onRuntimeInitialized=async t=>{FS.createPath("/","/userdata",!0,!0),FS.createPath("/","/home/web_user/retroarch/userdata",!0,!0),FS.createPath("/","/home/web_user/retroarch/bundle",!0,!0),FS.mount(this.IDBFS,{},"/userdata"),FS.mount(this.IDBFS,{},"/home/web_user/retroarch/userdata"),FS.mount(this.IDBFS,{},"/home/web_user/retroarch/bundle"),await FS.syncfs(!0,(async t=>{if(e){for(let t in e){let s="/home/web_user/retroarch/bundle/"+t.split("/").slice(0,-1).join("/");FS.analyzePath(s).exists||FS.createPath("/",s),FS.createDataFile(s,t.split("/").pop(),e[t],!0,!0),delete e[t]}e=null}if(!FS.analyzePath(this.__retroarchcfg).exists){let e='menu_mouse_enable = "true"\nmenu_pointer_enable = "true"\nmenu_driver = "glui"\nmaterialui_show_nav_bar = false\nvideo_font_size = "12.000000"\nmenu_widget_scale_auto = "false"\nmaterialui_icons_enable = false\nmenu_scale_factor = "2.000000"\nmenu_show_core_updater = "false"\nmenu_show_help = "false"\nmenu_show_information = "false"\nmenu_show_legacy_thumbnail_updater = "false"\nmenu_show_load_core = "false"\nmenu_show_quit_retroarch = "false"\nmenu_show_overlays = "false"\nmenu_show_online_updater = "false"\nsettings_show_accessibility = "false"\nsettings_show_user_interface = "false"\nsettings_show_user = "false"\nsettings_show_recording = "false"\nsettings_show_power_management = "false"\nsettings_show_playlists = "false"\nsettings_show_network = "false"\nsettings_show_logging = "false"\nsettings_show_file_browser = "false"\nsettings_show_directory = "false"\nsettings_show_core = "false"\nsettings_show_ai_service = "false"\nsettings_show_achievements = "false"\nsettings_show_drivers = "false"\nsettings_show_configuration = "false"\nsettings_show_frame_throttle = "false"\ncamera_allow = "false"\ncamera_driver = "null"\ncamera_device = ""\ninput_max_users = "1"\nbundle_assets_extract_enable = "false"\nquick_menu_show_information = "false"\nquick_menu_show_recording = "false"\nquick_menu_show_reset_core_association = "false"\nquick_menu_show_save_content_dir_overrides = "false"\nquick_menu_show_save_core_overrides = "false"\nquick_menu_show_save_game_overrides = "false"\nquick_menu_show_start_recording = "false"\nquick_menu_show_start_streaming = "false"\nquick_menu_show_streaming = "false"\nquick_menu_show_add_to_favorites = "false"\ncontent_show_favorites = "fasle"\ncontent_show_history = "fasle"\ncontent_show_music = "fasle"\ncontent_show_playlists = "fasle"\nmaterialui_playlist_icons_enable = "false"\ncontent_favorites_path = "null"\ncontent_history_path = "null"\ncontent_image_history_path = "null"\ncontent_music_history_path = "null"\nplaylist_directory = "null"\nauto_screenshot_filename = "false"\nsavestate_thumbnail_enable = "false"\nautosave_interval = "1"\nblock_sram_overwrite = "false"\nsavestate_file_compression = "false"\nsave_file_compression = "false"\nsavefile_directory = "/userdata/saves"\nsavestate_directory = "/userdata/states"\nscreenshot_directory = "/userdata/screenshots"\nsystem_directory = "/home/web_user/retroarch/bundle/system"\nrgui_browser_directory = "/userdata/rooms"\ncore_assets_directory = "/userdata/rooms/downloads"\ncheat_database_path = "/userdata/cheats"\n';FS.createDataFile("/home/web_user/retroarch/userdata","retroarch.cfg",e,!0,!0)}FS.createPath("/","/userdata/states",!0,!0),FS.createPath("/","/userdata/saves",!0,!0),FS.createPath("/","/userdata/rooms",!0,!0),FS.createPath("/","/userdata/rooms/downloads",!0,!0),FS.createPath("/","/userdata/screenshots",!0,!0),this.wasmReady()}))};let r=document.createElement("script");r.src=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})),r.onload=async e=>{window.URL.revokeObjectURL(r.src)},document.body.appendChild(r)}REPLACE_MODULE(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array&&(e=(new TextDecoder).decode(e)),e.replace(/var\s?__specialEventTargets\s?=\s?\[0,\s?typeof\s?document\s?!==\s?"undefined"\s?\?\s?document\s?:\s?0,\s?typeof\s?window\s?!==\s?"undefined"\s?\?\s?window\s?:\s?0\];/,"var __specialEventTargets=[0,Module.canvas,window];").replace(/var\s?rect\s?=\s?__specialEventTargets\.indexOf\(target\)\s?<\s?0\s?\?\s?__getBoundingClientRect\(target\)\s?:\s?\{\s*\n*\s*"left":\s*\d+,\n?\s*"top":\s*\d+\n?\s*\};/,"var rect= __getBoundingClientRect(Module.canvas);").replace(/if\s?\(!JSEvents\.mouseEvent\)\s?JSEvents\.mouseEvent\s?=\s?_malloc\(64\);/,"if (!JSEvents.mouseEvent) JSEvents.mouseEvent = _malloc(64);eventTypeString = eventTypeString.replace('mouse','pointer');").replace(/function\s?__findEventTarget\(target\)\s?\{/,'function __findEventTarget(target) {if(target>0&&UTF8ToString(target) == "#canvas") return Module.canvas;').replace(/function _fd_write\(fd,\s?iov,\s?iovcnt,\s?pnum\)\s?\{\s?\n?\s*try\s?\{\n?\s*var stream\s?=\s?SYSCALLS\.getStreamFromFD\(fd\);\n?\s*var\s?num\s?=\s?SYSCALLS\.doWritev\(stream,\s?iov,\s?iovcnt\);/,'function _fd_write(fd,iov,iovcnt,pnum){try{var stream=SYSCALLS.getStreamFromFD(fd);var num = SYSCALLS.doWritev(stream, iov, iovcnt);if(stream&&stream.node&&Module.IDBFS.DB_STORE_MAP[stream.node.mount.mountpoint]){if(stream.position==num){if(Module.EVENT.ontranslate&&/.png$/.test(stream.path)){Module.EVENT.translateimgpath = stream.path;clearTimeout(Module.EVENT.syncfsTimer);Module.EVENT.syncfsTimer = setTimeout(e=>Module.EVENT.BtnMap["Baidu"]("POST"),1000);}else if(/.srm$/.test(stream.path)||/.rtc$/.test(stream.path)){console.log(stream.path);clearTimeout(Module.EVENT.syncfsTimer);Module.EVENT.syncfsTimer = setTimeout(e=>FS.syncfs(e=>Module.HTML.syncfs(stream.path)),500);}}};')}async onReady(){let e=this.__coresname.split("_")[0];if(this.CONFIG=JSON.parse(localStorage.getItem(this.__coresname)||"{}"),this.CONFIG.version==this.version)return this.__installwasm();this.IDBFS.clearDB("assets"),this.__Fetch({url:"assets/assets.zip.js?"+Math.random(),error:e=>{},process:e=>this.HTML.MSG(e,!0),success:t=>{this.unZip(t).then((async t=>{let s=new Date;for(var r in this.__FILE__)t[r]&&(r==`${e}_libretro.js`&&(t[r]=this.REPLACE_MODULE(t[r])),await this.IDBFS.put("coredata",r,{content:t[r],mode:33206,timestamp:s})),t[r]=null,delete t[r];this.__installwasm(t)}))}})}constructor(){}SetConfig(e){for(let t in e)this.CONFIG[t]=e[t];localStorage.setItem(this.__coresname,JSON.stringify(this.CONFIG))}async __getFile(e){if(this.__FILE__[e])return this.__FILE__[e];let t=await this.IDBFS.getContent("coredata",e);if(!t)return this.__FILE__[e]=`assets/js/${e}`,this.__FILE__[e];if(/^unrar\-/.test(e)){let s=e.split(".")[0],r=s.charAt(s.length-1),a="m"==r?"mem":"w"==r?"wasm":"";if(a){let e=await this.IDBFS.getContent("coredata",`${s}.${a}`);e&&(this.__FILE__[`${s}.${a}`]=window.URL.createObjectURL(new Blob([e],{type:"text/javascript"})),t=(new TextDecoder).decode(t),t=t.replace(`${s}.${a}`,this.__FILE__[`${s}.${a}`]))}}return this.__FILE__[e]=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),this.__FILE__[e]}async __Fetch(e){let t=await fetch(e.url),s=t.headers.get("Content-Length")||1024,r=0;t.headers.get("Content-Type");if(404==t.status)return void(e.error&&e.error(t.statusText));const a=t.body.getReader(),n=new ReadableStream({start(t){let n=i=>{a.read().then((({done:a,value:i})=>{if(a)return t.close(),void(n=null);r+=i.length,e.process&&e.process(Math.floor(r/s*100)+"%",i.length,r),t.enqueue(i),n()}))};n()}});let i=await new Response(n)[e.type||"arrayBuffer"]();return e.success(i),i}IDBFS=new class{DB_NAME="RetroArch_MGBA";DB_STORE_NAME="FILE_DATA";DB_STORE_MAP={"/home/web_user/retroarch/userdata":"config","/home/web_user/retroarch/bundle":"assets","/userdata":"userdata"};get indexedDB(){let e=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB;if(!e)throw"IDBFS used, but indexedDB not supported";return e}mount(e){return FS.filesystems.MEMFS.mount.apply(null,arguments)}syncfs(e,t,s){return new Promise((r=>{s=s||r,this.getLocalSet(e,((r,a)=>{if(r)return s(r);let n=this.DB_STORE_MAP[e.mountpoint];if(!n)return s("Store Name erro");this.getRemoteSet(n).then((e=>{var r=t?e:a,i=t?a:e;this.reconcile(r,i,s,n)})).catch((e=>s(e)))}))}))}async get(e,t){var s=(await this.getDB(e)).transaction([e]).objectStore(e);return new Promise((e=>{let r=s.get(t);r.onsuccess=t=>e(r.result)}))}async getContent(e,t){var s=(await this.getDB(e)).transaction([e]).objectStore(e);return new Promise((e=>{let r=s.get(t);r.onsuccess=t=>e(r.result&&r.result.content||null)}))}async put(e,t,s){var r=(await this.getDB(e)).transaction([e],"readwrite").objectStore(e);return new Promise((e=>{let a=r.put(s,t);a.onsuccess=t=>e(a.result)}))}async getAllKeys(e,t,s){var r=(await this.getDB(e)).transaction([e],"readwrite").objectStore(e);return new Promise((e=>{let t=r.getAllKeys();t.onsuccess=s=>e(t.result)}))}async getAll(e,t,s){var r=(await this.getDB(e)).transaction([e],"readwrite").objectStore(e);return new Promise((e=>{let t=r.getAll();t.onsuccess=s=>e(t.result)}))}async getData(e,t,s){var r=(await this.getDB(e)).transaction([e],"readwrite").objectStore(e);return new Promise((e=>{var t={};r.openCursor().onsuccess=function(s){var r=s.target.result;r?(t[r.primaryKey]=r.value,r.continue()):e(t)}}))}async clearDB(e){if(!e)return this.indexedDB.deleteDatabase(this.DB_NAME);(await Module.IDBFS.getDB("assets")).transaction(["assets"],"readwrite").objectStore("assets").clear()}close(e){this.db&&this.close()}async getDB(e,t){return new Promise(((s,r)=>{if(this.db){if(this.db.objectStoreNames.contains(e))return s(this.db);this.db.close(),t=this.db.version+1}let a=this.indexedDB.open(this.DB_NAME,t);if(!a)return r("Unable to connect to IndexedDB");a.onupgradeneeded=t=>{var s,r=t.target.result,a=t.target.transaction;if(r.objectStoreNames.contains(e))(s=a.objectStore(e)).indexNames.contains("timestamp")||s.createIndex("timestamp","timestamp",{unique:!1});else{for(var n in this.DB_STORE_MAP){if(r.objectStoreNames.contains(this.DB_STORE_MAP[n]))continue;let t=r.createObjectStore(this.DB_STORE_MAP[n]);t.indexNames.contains("timestamp")||t.createIndex("timestamp","timestamp",{unique:!1}),this.DB_STORE_MAP[n]==e&&(s=t)}s||(s=r.objectStoreNames.contains(e)).indexNames.contains("timestamp")||s.createIndex("timestamp","timestamp",{unique:!1})}},a.onsuccess=async r=>{let a=r.target.result;a.objectStoreNames.contains(e)?this.db=a:(t=a.version+1,a.close(),this.db=await this.getDB(e,t)),s(this.db)},a.onerror=e=>{r(a.error),e.preventDefault()}}))}getLocalSet(e,t){let s={},r=e=>"."!==e&&".."!==e,a=e=>function(t){return PATH.join2(e,t)},n=FS.readdir(e.mountpoint).filter(r).map(a(e.mountpoint));for(;n.length;){var i,o=n.pop();try{i=FS.stat(o)}catch(e){return t(e)}FS.isDir(i.mode)&&n.push.apply(n,FS.readdir(o).filter(r).map(a(o))),s[o]={timestamp:i.mtime}}return t(null,{type:"local",entries:s})}async getRemoteSet(e){return new Promise(((t,s)=>{var r={};this.getDB(e).then((a=>{var n=a.transaction([e],"readonly");n.onerror=e=>{s(n.error),e.preventDefault()},n.objectStore(e).index("timestamp").openKeyCursor().onsuccess=function(e){var s=e.target.result;if(!s)return t({type:"remote",db:a,entries:r});r[s.primaryKey]={timestamp:s.key},s.continue()}})).catch((e=>s(e)))}))}loadLocalEntry(e,t){var s,r;try{r=FS.lookupPath(e).node,s=FS.stat(e)}catch(e){return t(e)}return FS.isDir(s.mode)?t(null,{timestamp:s.mtime,mode:s.mode}):FS.isFile(s.mode)?(r.contents=MEMFS.getFileDataAsTypedArray(r),t(null,{timestamp:s.mtime,mode:s.mode,contents:r.contents})):t(new Error("node type not supported"))}storeLocalEntry(e,t,s){try{if(FS.isDir(t.mode))FS.mkdir(e,t.mode);else{if(!FS.isFile(t.mode))return s(new Error("node type not supported"));FS.writeFile(e,t.contents,{canOwn:!0})}FS.chmod(e,t.mode),FS.utime(e,t.timestamp,t.timestamp)}catch(e){return s(e)}s(null)}removeLocalEntry(e,t){try{FS.lookupPath(e);var s=FS.stat(e);FS.isDir(s.mode)?FS.rmdir(e):FS.isFile(s.mode)&&FS.unlink(e)}catch(e){return t(e)}t(null)}loadRemoteEntry(e,t,s){var r=e.get(t);r.onsuccess=function(e){s(null,e.target.result)},r.onerror=e=>{s(r.error),e.preventDefault()}}storeRemoteEntry(e,t,s,r){var a=e.put(s,t);a.onsuccess=function(){r(null)},a.onerror=e=>{r(a.error),e.preventDefault()}}removeRemoteEntry(e,t,s){var r=e.delete(t);r.onsuccess=function(){s(null)},r.onerror=e=>{s(r.error),e.preventDefault()}}reconcile(e,t,s,r){var a=0,n=[];Object.keys(e.entries).forEach((s=>{var r=e.entries[s],i=t.entries[s];(!i||r.timestamp>i.timestamp)&&(n.push(s),a++)}));var i=[];if(Object.keys(t.entries).forEach((s=>{t.entries[s];e.entries[s]||(i.push(s),a++)})),!a)return s(null);var o=0,l=("remote"===e.type?e.db:t.db).transaction([r],"readwrite"),c=l.objectStore(r),u=e=>e?u.errored?void 0:(u.errored=!0,s(e)):++o>=a?s(null):void 0;l.onerror=e=>{u(l.error),e.preventDefault()},n.sort().forEach((e=>{"local"===t.type?this.loadRemoteEntry(c,e,((t,s)=>{if(t)return u(t);this.storeLocalEntry(e,s,u)})):this.loadLocalEntry(e,((t,s)=>{if(t)return u(t);this.storeRemoteEntry(c,e,s,u)}))})),i.sort().reverse().forEach((e=>{"local"===t.type?this.removeLocalEntry(e,u):this.removeRemoteEntry(c,e,u)}))}};async un7z(e,t){let s=await this.__getFile("un7z.min.js");return new Promise(((t,r)=>{let a=new Worker(s);a.onmessage=e=>{t(e.data),a.terminate()},a.postMessage(e)}))}async unZip(e,t,s){let r=await this.__getFile("jszip.min.js");return new Promise(((t,s)=>{let a=new Worker(r);return a.onmessage=e=>{t(e.data),a.terminate()},a.postMessage(e),e=null,{}}))}async unRAR(e,t,s){let r,a=(new TextDecoder).decode(new Uint8Array(e.subarray(0,8)));return r=/Rar!$/.test(a)?await this.__getFile("unrar-5-m.min.js"):await this.__getFile("unrar-5-m.js"),t=t+".rar"||"test.rar",new Promise(((a,n)=>{let i=new Worker(r);i.onmessage=e=>{a(e.data),i.terminate()},i.addEventListener("error",(e=>{})),i.onerror=async s=>{"Uncaught Missing password"==s.message||"Uncaught File CRC error"==s.message?(this.HTML.RAR_HTML(s.message),this.BtnMap.unrar=s=>{let r=this.HTML.RAR_PASSWORD();r&&(this.BtnMap.unrar=null,this.BtnMap.closelist(),i.postMessage({data:[{name:t,content:e}],password:r}))},this.BtnMap.exitrar=e=>{i.terminate(),this.BtnMap.closelist()}):(this.HTML.RAR_ERROR(s),i.terminate())},i.postMessage({data:[{name:t,content:e}],password:s})}))}KeyMap={input_player1_a:"x",input_player1_b:"z",input_player1_down:"down",input_player1_l:"q",input_player1_l2:"nul",input_player1_l3:"nul",input_player1_left:"left",input_player1_r:"w",input_player1_r2:"nul",input_player1_r3:"nul",input_player1_right:"right",input_player1_select:"rshift",input_player1_start:"enter",input_player1_turbo:"nul",input_player1_up:"up",input_player1_x:"s",input_player1_y:"a",input_toggle_fast_forward:"space",input_toggle_fullscreen:"f",input_reset:"h",input_screenshot:"f8",input_load_state:"f4",input_save_state:"f2",input_menu_toggle:"f1",input_toggle_slowmotion:null};keyToCode={tilde:"Backquote",num1:"Digit1",num2:"Digit2",num3:"Digit3",num4:"Digit4",num5:"Digit5",num6:"Digit6",num7:"Digit7",num8:"Digit8",num9:"Digit9",num0:"Digit0",minus:"Minus",equal:"Equal",backspace:"Backspace",tab:"Tab",q:"KeyQ",w:"KeyW",e:"KeyE",r:"KeyR",t:"KeyT",y:"KeyY",u:"KeyU",i:"KeyI",o:"KeyO",p:"KeyP",a:"KeyA",s:"KeyS",d:"KeyD",f:"KeyF",g:"KeyG",h:"KeyH",j:"KeyJ",k:"KeyK",l:"KeyL",z:"KeyZ",x:"KeyX",c:"KeyC",v:"KeyV",b:"KeyB",n:"KeyN",m:"KeyM",leftbracket:"BracketLeft",rightbracket:"BracketRight",backslash:"Backslash",capslock:"CapsLock",semicolon:"Semicolon",quote:"Quote",enter:"Enter",shift:"ShiftLeft",comma:"Comma",period:"Period",slash:"Slash",rshift:"ShiftRight",ctrl:"ControlLeft",lmeta:"MetaLeft",alt:"AltLeft",space:"Space",ralt:"AltRight",menu:"ContextMenu",rctrl:"ControlRight",up:"ArrowUp",left:"ArrowLeft",down:"ArrowDown",right:"ArrowRight",kp_period:"NumpadDecimal",kp_enter:"NumpadEnter",keypad0:"Numpad0",keypad1:"Numpad1",keypad2:"Numpad2",keypad3:"Numpad3",keypad4:"Numpad4",keypad5:"Numpad5",keypad6:"Numpad6",keypad7:"Numpad7",keypad8:"Numpad8",keypad9:"Numpad9",add:"NumpadAdd",numlock:"NumLock",divide:"NumpadDivide",multiply:"NumpadMultiply",subtract:"NumpadSubtract",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",del:"Delete",insert:"Insert",f12:"F12",f10:"F10",f9:"F9",f8:"F8",f7:"F7",f6:"F6",f5:"F5",f4:"F4",f3:"F3",f2:"F2",f1:"F1",escape:"Escape"}};"function"!=typeof IDBObjectStore.prototype.getAll&&(IDBObjectStore.prototype.getAll=function(e){var t={},s=this.openCursor(e);s.onerror=function(e){"function"==typeof t.onerror&&t.onerror(e)};var r=[];return s.onsuccess=function(e){if("function"==typeof t.onsuccess){var s=e.target.result;s?(r.push(s.value),s.continue()):(t.result=r,e.target.result=r,t.onsuccess(e))}},t});